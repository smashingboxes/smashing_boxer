- name: clone the app
  when: docker_app_repo is defined
  remote_user: "{{ deployer_user.name }}"
  git: dest={{ docker_app_path }}
       repo={{ docker_app_repo }}
       version={{ docker_app_branch }}
       accept_hostkey=true
       force=yes

- command: chdir={{ docker_app_path }}
           git ls-files Dockerfile
  remote_user: "{{ deployer_user.name }}"
  register: docker_file

- command: chdir={{ docker_app_path }}
           git ls-files docker-compose.production.yml
  remote_user: "{{ deployer_user.name }}"
  register: production_compose_file

- name: copy Dockerfile
  command: chdir={{ docker_app_path }}
           bash -lc "/bin/cp {{tapefiles_dir}}/Dockerfile {{docker_app_path}}"
  remote_user: "{{ deployer_user.name }}"
  when: docker_file.stdout.find('Dockerfile') == -1

- name: copy docker-compose file
  command: chdir={{ docker_app_path }}
           bash -lc "/bin/cp {{tapefiles_dir}}/docker-compose.production.yml {{docker_app_path}}"
  remote_user: "{{ deployer_user.name }}"
  when: docker_file.stdout.find('docker-compose.production.yml') == -1
